(()=>{"use strict";const t=document.querySelector("#gamesboard-container"),e=function(e,o){const n=document.createElement("div");n.classList.add("game-board"),n.style.backgroundColor=e,n.id=o;for(let t=0;t<100;t++){const e=document.createElement("div");e.classList.add("block"),e.id=t,n.append(e)}t.append(n)};class o{constructor(t,e){this.name=t,this.length=e}}const n=[new o("carrier",5),new o("battleship",4),new o("cruiser",3),new o("submarine",3),new o("destroyer",2)],r=document.querySelector(".option-container"),s=document.querySelector("#flip-button"),c=document.querySelector("#start-button"),a=document.querySelector("#info"),i=document.querySelector("#turn-display");a.textContent=" Drag your ships onto your board",e("white","player"),e("black","computer");let l,u,d=0;function m(t,e,o,n){let r,s=e?o<=100-n.length?o:100-n.length:o<=100-10*n.length?o:o-10*n.length+10,c=[];for(let o=0;o<n.length;o++)e?c.push(t[Number(s)+o]):c.push(t[Number(s)+10*o]);e?c.every(((t,e)=>r=c[0].id%10!=10-(c.length-(e+1)))):c.every(((t,e)=>r=c[0].id<10*e+1+90));const a=c.every((t=>!t.classList.contains("taken")));return{shipBlocks:c,valid:r,notTaken:a}}function h(t,e,o){const n=document.querySelectorAll(`#${t} div`);let r=Math.random()<.5,s="player"===t?0===d:r,c=Math.floor(100*Math.random()),a=o||c;const{shipBlocks:i,valid:u,notTaken:p}=m(n,s,a,e);u&&p?i.forEach((t=>{t.classList.add(e.name),t.classList.add("taken")})):("computer"===t&&h("computer",e,o),"player"===t&&(l=!0))}function p(t){l=!1,u=t.target}function f(t){t.preventDefault();const e=n[u.id];!function(t,e){const o=document.querySelectorAll("#player div");let n=0===d;const{shipBlocks:r,valid:s,notTaken:c}=m(o,n,t,e);s&&c&&r.forEach((t=>{t.classList.add("hover"),setTimeout((()=>t.classList.remove("hover")),500)}))}(t.target.id,e)}function y(t){const e=t.target.id;h("player",n[u.id],e),l||u.remove()}s.addEventListener("click",(function(){const t=Array.from(r.children);d=0===d?90:0,t.forEach((t=>t.style.transform=`rotate(${d}deg)`))})),n.forEach((t=>h("computer",t))),Array.from(r.children).forEach((t=>t.addEventListener("dragstart",p))),document.querySelectorAll("#player div").forEach((t=>{t.addEventListener("dragover",f),t.addEventListener("drop",y)}));let g,k=!1;c.addEventListener("click",(function(){void 0===g&&(0!=r.children.length?a.textContent="Please place all your pieces first":(document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",E))),g=!0,i.textContent=" Your turn",a.textContent="The game has started"))}));let v=[],L=[];const b=[],C=[];function E(t){if(!k){if(t.target.classList.contains("taken")){t.target.classList.add("boom"),a.textContent=" You hit the computers ship";let e=Array.from(t.target.classList);e=e.filter((t=>"block"!==t)),e=e.filter((t=>"boom"!==t)),e=e.filter((t=>"taken"!==t)),v.push(...e),q("player",v,b)}t.target.classList.contains("taken")||(a.textContent=" Nothing hit this time",t.target.classList.add("empty")),g=!1,document.querySelectorAll("#computer div").forEach((t=>t.replaceWith(t.cloneNode(!0)))),setTimeout(x,2e3)}}function x(){k||(i.textContent=" Computer Go!",a.textContent="The computer is thinking...",setTimeout((()=>{let t=Math.floor(100*Math.random());const e=document.querySelectorAll("#player div");if(e[t].classList.contains("taken")&&e[t].classList.contains("boom"))x();else if(e[t].classList.contains("taken")&&!e[t].classList.contains("boom")){e[t].classList.add("boom"),a.textContent="The computer hit your ship!";let o=Array.from(e[t].classList);o=o.filter((t=>"block"!==t)),o=o.filter((t=>"boom"!==t)),o=o.filter((t=>"taken"!==t)),L.push(...o),q("computer",L,C)}else a.textContent="Nothing hit this time",e[t].classList.add("empty")}),2e3),setTimeout((()=>{g=!0,i.textContent=" Your Turn",a.textContent="Please take your turn",document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",E)))}),4e3))}function q(t,e,o){function n(n,r){e.filter((t=>t===n)).length===r&&("player"===t&&(a.textContent=` You sunk computer's ${n}`,v=e.filter((t=>t!==n))),"computer"===t&&(a.textContent=`The computer sunk your ${n}`,L=e.filter((t=>t!==n))),o.push(n))}n("destroyer",2),n("submarine",3),n("cruiser",3),n("battleship",4),n("carrier",5),5===b.length&&(a.textContent="You sunk all the computers ships. You won",k=!0),5===C.length&&(a.textContent="The computer sunk all your ships. You lose",k=!0)}})();