(()=>{"use strict";const t=document.querySelector("#gamesboard-container"),e=function(e,n){const o=document.createElement("div");o.classList.add("game-board"),o.style.backgroundColor=e,o.id=n;for(let t=0;t<100;t++){const e=document.createElement("div");e.classList.add("block"),e.id=t,o.append(e)}t.append(o)};class n{constructor(t,e){this.name=t,this.length=e}}const o=[new n("carrier",5),new n("battleship",4),new n("cruiser",3),new n("submarine",3),new n("destroyer",2)],r=document.querySelector(".option-container"),s=document.querySelector("#flip-button"),c=document.querySelector("#start-button"),i=document.querySelector("#info"),a=document.querySelector("#turn-display");i.textContent=" Drag your ships onto your board",e("white","player"),e("black","computer");let l,u,d=0;function h(t,e,n,o){let r,s=e?n<=100-o.length?n:100-o.length:n<=100-10*o.length?n:n-10*o.length+10,c=[];for(let n=0;n<o.length;n++)e?c.push(t[Number(s)+n]):c.push(t[Number(s)+10*n]);e?c.every(((t,e)=>r=c[0].id%10!=10-(c.length-(e+1)))):c.every(((t,e)=>r=c[0].id<10*e+1+90));const i=c.every((t=>!t.classList.contains("taken")));return{shipBlocks:c,valid:r,notTaken:i}}function m(t,e,n){const o=document.querySelectorAll(`#${t} div`);let r=Math.random()<.5,s="player"===t?0===d:r,c=Math.floor(100*Math.random()),i=n||c;const{shipBlocks:a,valid:u,notTaken:p}=h(o,s,i,e);u&&p?a.forEach((t=>{t.classList.add(e.name),t.classList.add("taken")})):("computer"===t&&m("computer",e,n),"player"===t&&(l=!0))}function p(t){l=!1,u=t.target}function f(t){t.preventDefault();const e=o[u.id];!function(t,e){const n=document.querySelectorAll("#player div");let o=0===d;const{shipBlocks:r,valid:s,notTaken:c}=h(n,o,t,e);s&&c&&r.forEach((t=>{t.classList.add("hover"),setTimeout((()=>t.classList.remove("hover")),500)}))}(t.target.id,e)}function y(t){const e=t.target.id;m("player",o[u.id],e),l||u.remove()}s.addEventListener("click",(function(){const t=Array.from(r.children);d=0===d?90:0,t.forEach((t=>t.style.transform=`rotate(${d}deg)`))})),o.forEach((t=>m("computer",t))),Array.from(r.children).forEach((t=>t.addEventListener("dragstart",p))),document.querySelectorAll("#player div").forEach((t=>{t.addEventListener("dragover",f),t.addEventListener("drop",y)}));let g,k=!1;c.addEventListener("click",(function(){void 0===g&&(0!=r.children.length?i.textContent="Please place all your pieces first":(document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",b))),g=!0,a.textContent=" Your turn",i.textContent="The game has started"))}));let v=[],L=[];const C=[],E=[];function b(t){if(!k){if(t.target.classList.contains("taken")){t.target.classList.add("hit"),i.textContent=" You hit the computers ship";let e=Array.from(t.target.classList);e=e.filter((t=>"block"!==t)),e=e.filter((t=>"hit"!==t)),e=e.filter((t=>"taken"!==t)),v.push(...e),T("player",v,C)}t.target.classList.contains("taken")||(i.textContent=" Nothing hit this time",t.target.classList.add("miss")),g=!1,document.querySelectorAll("#computer div").forEach((t=>t.replaceWith(t.cloneNode(!0)))),setTimeout(x,2e3)}}function x(){k||(a.textContent=" Computer's Turn",i.textContent="The computer is thinking...",setTimeout((()=>{let t=Math.floor(100*Math.random());const e=document.querySelectorAll("#player div");if(e[t].classList.contains("taken")&&e[t].classList.contains("hit"))x();else if(e[t].classList.contains("taken")&&!e[t].classList.contains("hit")){e[t].classList.add("hit"),i.textContent="The computer hit your ship!";let n=Array.from(e[t].classList);n=n.filter((t=>"block"!==t)),n=n.filter((t=>"hit"!==t)),n=n.filter((t=>"taken"!==t)),L.push(...n),T("computer",L,E)}else i.textContent="Nothing hit this time",e[t].classList.add("miss")}),2e3),setTimeout((()=>{g=!0,a.textContent=" Your Turn",i.textContent="Please take your turn",document.querySelectorAll("#computer div").forEach((t=>t.addEventListener("click",b)))}),4e3))}function T(t,e,n){function o(o,r){e.filter((t=>t===o)).length===r&&("player"===t&&(i.textContent=` You sunk computer's ${o}`,v=e.filter((t=>t!==o))),"computer"===t&&(i.textContent=`The computer sunk your ${o}`,L=e.filter((t=>t!==o))),n.push(o))}o("destroyer",2),o("submarine",3),o("cruiser",3),o("battleship",4),o("carrier",5),5===C.length&&(i.textContent="You sunk all the computers ships. You won",k=!0),5===E.length&&(i.textContent="The computer sunk all your ships. You lose",k=!0)}})();